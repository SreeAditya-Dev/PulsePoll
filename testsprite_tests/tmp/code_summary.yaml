version: "2"
type: backend
tech_stack:
  - Node.js
  - Express
  - TypeScript
  - Socket.IO
  - Supabase (PostgreSQL)
  - Redis
features:
  - name: Poll Creation API
    description: Create new polls with a question and multiple options
    files:
      - backend/src/routes/polls.ts
    endpoints:
      - method: POST
        path: /api/polls
        description: Create a new poll with question and options
        auth_required: false
        request_schema:
          body:
            question: string
            options: string[]
            fingerprint: string
        response_schema:
          "201": "{ pollId: string, shareCode: string }"
          "400": "Validation error (missing question, < 2 options, > 10 options)"
    depends_on: []

  - name: Poll Retrieval API
    description: Fetch poll details by share code including options and vote counts
    files:
      - backend/src/routes/polls.ts
    endpoints:
      - method: GET
        path: /api/polls/:shareCode
        description: Get poll details, options, and vote tallies
        auth_required: false
        response_schema:
          "200": "{ poll: Poll, options: PollOption[], tallies: Record<string, number>, totalVotes: number, hasVoted: boolean }"
          "404": "Poll not found"
    depends_on:
      - Poll Creation API

  - name: Vote Submission API
    description: Cast a vote on a poll option with anti-abuse checks
    files:
      - backend/src/routes/polls.ts
      - backend/src/middleware/rateLimit.ts
    endpoints:
      - method: POST
        path: /api/polls/:shareCode/vote
        description: Submit a vote for a specific option
        auth_required: false
        request_schema:
          body:
            optionId: string
            fingerprint: string
        response_schema:
          "200": "{ success: true, message: string }"
          "404": "Poll not found or option not found"
          "409": "Already voted (IP rate limit or fingerprint constraint)"
          "410": "Poll is no longer active"
    depends_on:
      - Poll Creation API
      - Poll Retrieval API

  - name: Health Check
    description: Basic health check endpoint
    files:
      - backend/src/index.ts
    endpoints:
      - method: GET
        path: /api/health
        description: Returns server health status
        auth_required: false
        response_schema:
          "200": "{ status: ok }"
    depends_on: []

  - name: Real-Time Socket.IO
    description: WebSocket-based real-time vote updates using Socket.IO rooms
    files:
      - backend/src/socket/pollRooms.ts
    endpoints: []
    depends_on:
      - Vote Submission API

  - name: Anti-Abuse Rate Limiting
    description: IP-based and fingerprint-based vote deduplication
    files:
      - backend/src/middleware/rateLimit.ts
    endpoints: []
    depends_on: []

known_limitations:
  - issue: Users can bypass fingerprinting by using incognito mode or a different browser
    location: backend/src/routes/polls.ts
    impact: Allows duplicate votes from same user with different fingerprints
  - issue: Users behind same NAT/VPN share an IP and may be blocked
    location: backend/src/middleware/rateLimit.ts
    impact: Legitimate users may be falsely blocked from voting
  - issue: No authentication system - polls are fully anonymous
    location: backend/src/routes/polls.ts
    impact: No ability to manage or delete polls after creation
